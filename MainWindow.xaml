<Window
    x:Class="NineLivesAudio.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <!-- Loading Overlay (shown during init) -->
        <Grid x:Name="InitOverlay" Canvas.ZIndex="100">
            <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="16">
                    <ProgressRing x:Name="InitSpinner" IsActive="True" Width="48" Height="48"/>
                    <TextBlock x:Name="InitStatusText" Text="Starting up..."
                               FontSize="14" Opacity="0.6" HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Init Error Panel (shown if init fails) -->
        <Grid x:Name="InitErrorPanel" Visibility="Collapsed" Canvas.ZIndex="100">
            <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
                <StackPanel Style="{StaticResource EmptyStateContainerStyle}">
                    <FontIcon Glyph="&#xE783;" Style="{StaticResource EmptyStateIconStyle}"/>
                    <TextBlock Text="Startup Failed" Style="{StaticResource EmptyStateTitleStyle}"/>
                    <TextBlock x:Name="InitErrorText" Style="{StaticResource EmptyStateSubtitleStyle}"/>
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12"
                                Margin="0,12,0,0">
                        <Button x:Name="RetryButton" Click="RetryInit_Click"
                                Style="{ThemeResource AccentButtonStyle}" Content="Retry"/>
                        <Button x:Name="OpenLogsButton" Click="OpenLogs_Click" Content="Open Logs"/>
                        <Button x:Name="ResetButton" Click="ResetConnection_Click" Content="Reset"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- Main App Content -->
        <Grid x:Name="AppContent" Visibility="Collapsed">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <NavigationView x:Name="NavView" Grid.Row="0"
                            PaneDisplayMode="LeftCompact"
                            CompactModeThresholdWidth="0"
                            ExpandedModeThresholdWidth="900"
                            CompactPaneLength="48"
                            OpenPaneLength="200"
                            IsBackButtonVisible="Auto"
                            BackRequested="NavView_BackRequested"
                            IsSettingsVisible="True"
                            SelectionChanged="NavView_SelectionChanged">

                <NavigationView.MenuItems>
                    <NavigationViewItem Content="Home"
                                        Tag="Home">
                        <NavigationViewItem.Icon>
                            <FontIcon Glyph="&#xE80F;"/>
                        </NavigationViewItem.Icon>
                    </NavigationViewItem>
                    <NavigationViewItem Content="Library"
                                        Tag="Library"
                                        Icon="Library"/>
                    <NavigationViewItem Content="Now Playing"
                                        Tag="Player"
                                        Icon="Play"/>
                    <NavigationViewItem Content="Downloads"
                                        Tag="Downloads"
                                        Icon="Download"/>
                </NavigationView.MenuItems>

                <NavigationView.FooterMenuItems>
                    <NavigationViewItem x:Name="ConnectivityIndicator"
                                        SelectsOnInvoked="False"
                                        IsEnabled="False">
                        <NavigationViewItem.Icon>
                            <FontIcon x:Name="ConnectivityIcon" Glyph="&#x25CF;" FontSize="16"
                                      Foreground="{StaticResource RitualSuccessBrush}"/>
                        </NavigationViewItem.Icon>
                        <NavigationViewItem.Content>
                            <TextBlock x:Name="ConnectivityText" Text="Connected"
                                       FontSize="11"
                                       Foreground="{StaticResource MistFaintBrush}"/>
                        </NavigationViewItem.Content>
                    </NavigationViewItem>
                </NavigationView.FooterMenuItems>

                <Frame x:Name="ContentFrame" Padding="0"/>
            </NavigationView>

            <!-- Mini Player Bar -->
            <Grid x:Name="MiniPlayerBar" Grid.Row="1"
                  Background="{StaticResource VoidSurfaceBrush}"
                  BorderBrush="{StaticResource DustBrush}"
                  BorderThickness="0,1,0,0"
                  Height="72" Padding="16,0"
                  Visibility="Collapsed"
                  PointerPressed="MiniPlayer_PointerPressed">

                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Album Art -->
                <Border Grid.Column="0" Width="52" Height="52" CornerRadius="6" Margin="0,0,12,0"
                        Style="{StaticResource CoverImageBorderStyle}">
                    <Grid>
                        <FontIcon Glyph="&#xE8F1;" FontSize="20" Opacity="0.15"
                                  Foreground="{StaticResource MistFaintBrush}"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        <Image x:Name="MiniPlayerArt" Stretch="UniformToFill"/>
                    </Grid>
                </Border>

                <!-- Book Info + Progress -->
                <Grid Grid.Column="1" VerticalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <TextBlock x:Name="MiniPlayerTitle" Grid.Row="0"
                               Style="{StaticResource CardTitleStyle}"
                               Foreground="{StaticResource StarlightDimBrush}"
                               MaxLines="1"/>
                    <TextBlock x:Name="MiniPlayerAuthor" Grid.Row="1"
                               Style="{StaticResource SubtitleStyle}"
                               Foreground="{StaticResource MistBrush}"/>
                    <ProgressBar x:Name="MiniPlayerProgress" Grid.Row="2"
                                 Style="{StaticResource MiniPlayerProgressStyle}"
                                 Foreground="{StaticResource SigilGoldBrush}"/>
                </Grid>

                <!-- Playback Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4"
                            VerticalAlignment="Center" Margin="12,0,0,0">
                    <Button x:Name="MiniRewindBtn" Click="MiniRewind_Click"
                            Style="{StaticResource IconButtonStyle}" ToolTipService.ToolTip="Back 10s">
                        <FontIcon Glyph="&#xE892;" FontSize="14"/>
                    </Button>
                    <Button x:Name="MiniPlayPauseBtn" Click="MiniPlayPause_Click"
                            Style="{StaticResource CircularButtonStyle}">
                        <FontIcon x:Name="MiniPlayPauseIcon" Glyph="&#xE768;" FontSize="18"/>
                    </Button>
                    <Button x:Name="MiniForwardBtn" Click="MiniForward_Click"
                            Style="{StaticResource IconButtonStyle}" ToolTipService.ToolTip="Forward 30s">
                        <FontIcon Glyph="&#xE893;" FontSize="14"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Toast/Notification Bar -->
            <InfoBar x:Name="AppNotification" Grid.Row="2"
                     IsOpen="False"
                     IsClosable="True"
                     Closed="AppNotification_Closed"/>
        </Grid>
    </Grid>
</Window>
