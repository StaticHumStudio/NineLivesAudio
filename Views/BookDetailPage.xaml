<Page
    x:Class="AudioBookshelfApp.Views.BookDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Loaded="Page_Loaded">

    <Grid x:Name="RootGrid">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="LayoutStates">
                <!-- Wide: > 900px — side-by-side, full desktop layout -->
                <VisualState x:Name="WideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="900"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="BookHeaderGrid.Visibility" Value="Visible"/>
                        <Setter Target="BookHeaderNarrow.Visibility" Value="Collapsed"/>
                        <Setter Target="ContentScrollViewer.Padding" Value="24"/>
                        <Setter Target="ContentStackPanel.MaxWidth" Value="900"/>
                        <Setter Target="ActionButtonsPanel.Orientation" Value="Horizontal"/>
                        <Setter Target="PlayButton.HorizontalAlignment" Value="Left"/>
                        <Setter Target="DownloadButton.HorizontalAlignment" Value="Left"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Medium: 600–900px — side-by-side but compact cover -->
                <VisualState x:Name="MediumState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="600"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="BookHeaderGrid.Visibility" Value="Visible"/>
                        <Setter Target="BookHeaderNarrow.Visibility" Value="Collapsed"/>
                        <Setter Target="ContentScrollViewer.Padding" Value="16"/>
                        <Setter Target="ContentStackPanel.MaxWidth" Value="900"/>
                        <Setter Target="CoverBorder.Width" Value="140"/>
                        <Setter Target="CoverBorder.Height" Value="210"/>
                        <Setter Target="ActionButtonsPanel.Orientation" Value="Horizontal"/>
                        <Setter Target="PlayButton.HorizontalAlignment" Value="Left"/>
                        <Setter Target="DownloadButton.HorizontalAlignment" Value="Left"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Narrow: < 600px — stacked layout, cover above text -->
                <VisualState x:Name="NarrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="BookHeaderGrid.Visibility" Value="Collapsed"/>
                        <Setter Target="BookHeaderNarrow.Visibility" Value="Visible"/>
                        <Setter Target="ContentScrollViewer.Padding" Value="12"/>
                        <Setter Target="ContentStackPanel.MaxWidth" Value="600"/>
                        <Setter Target="ActionButtonsPanel.Orientation" Value="Vertical"/>
                        <Setter Target="PlayButton.HorizontalAlignment" Value="Stretch"/>
                        <Setter Target="DownloadButton.HorizontalAlignment" Value="Stretch"/>
                        <Setter Target="BackButtonLabel.Visibility" Value="Collapsed"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header with Back Button -->
        <Grid Grid.Row="0" Padding="16,8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
            <Button Click="BackButton_Click" Background="Transparent" BorderThickness="0" HorizontalAlignment="Left">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <FontIcon Glyph="&#xE72B;" FontSize="16"/>
                    <TextBlock x:Name="BackButtonLabel" Text="Back to Library" VerticalAlignment="Center"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Content -->
        <ScrollViewer x:Name="ContentScrollViewer" Grid.Row="1" Padding="16">
            <StackPanel x:Name="ContentStackPanel" Spacing="20" MaxWidth="900" HorizontalAlignment="Left">

                <!-- === WIDE/MEDIUM: Side-by-side Cover + Info === -->
                <Grid x:Name="BookHeaderGrid">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Cover Image -->
                    <Border x:Name="CoverBorder" Grid.Column="0"
                            CornerRadius="8"
                            Width="180"
                            Height="270"
                            Background="{ThemeResource SystemControlBackgroundBaseLowBrush}">
                        <Grid>
                            <FontIcon Glyph="&#xE8F1;" FontSize="64" Opacity="0.3"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <Image x:Name="CoverImage" Stretch="UniformToFill"/>
                        </Grid>
                    </Border>

                    <!-- Book Info -->
                    <StackPanel Grid.Column="1" Margin="24,0,0,0" Spacing="6">
                        <TextBlock x:Name="TitleText" FontSize="24" FontWeight="Bold" TextWrapping="Wrap"/>

                        <!-- Author (clickable) -->
                        <HyperlinkButton x:Name="AuthorLink" Click="AuthorLink_Click" Padding="0">
                            <TextBlock x:Name="AuthorText" FontSize="16"/>
                        </HyperlinkButton>

                        <!-- Narrator -->
                        <TextBlock x:Name="NarratorText" FontSize="14" Opacity="0.6" Visibility="Collapsed"/>

                        <!-- Series (clickable) -->
                        <HyperlinkButton x:Name="SeriesLink" Click="SeriesLink_Click" Padding="0" Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8F1;" FontSize="12"/>
                                <TextBlock x:Name="SeriesText" FontSize="14"/>
                            </StackPanel>
                        </HyperlinkButton>

                        <!-- Duration -->
                        <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,4,0,0">
                            <FontIcon Glyph="&#xE916;" FontSize="12" Opacity="0.6"/>
                            <TextBlock x:Name="DurationText" FontSize="14" Opacity="0.6"/>
                        </StackPanel>

                        <!-- Added Date -->
                        <TextBlock x:Name="AddedAtText" FontSize="12" Opacity="0.5" Visibility="Collapsed"/>

                        <!-- Progress Section -->
                        <StackPanel x:Name="ProgressPanel" Margin="0,12,0,0" Spacing="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock x:Name="ProgressText" FontSize="14" VerticalAlignment="Center"/>
                                <ToggleSwitch x:Name="ChapterToggle" Grid.Column="1"
                                              Header="By Chapter" OnContent="" OffContent=""
                                              Toggled="ChapterToggle_Toggled"
                                              Visibility="Collapsed"
                                              Margin="12,0,0,0" MinWidth="0"/>
                            </Grid>
                            <ProgressBar x:Name="ProgressBar" Maximum="100" Height="8"
                                         Foreground="#FF00CC66"/>
                            <TextBlock x:Name="ChapterInfoText" FontSize="12" Opacity="0.6"
                                       Visibility="Collapsed"/>
                        </StackPanel>

                        <!-- Action Buttons -->
                        <StackPanel x:Name="ActionButtonsPanel" Orientation="Horizontal" Spacing="12" Margin="0,16,0,0">
                            <Button x:Name="PlayButton" Click="PlayButton_Click"
                                    Style="{ThemeResource AccentButtonStyle}" Padding="24,12">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon x:Name="PlayIcon" Glyph="&#xE768;" FontSize="16"/>
                                    <TextBlock x:Name="PlayButtonText" Text="Play"/>
                                </StackPanel>
                            </Button>
                            <Button x:Name="DownloadButton" Click="DownloadButton_Click" Padding="24,12">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon x:Name="DownloadIcon" Glyph="&#xE896;" FontSize="16"/>
                                    <TextBlock x:Name="DownloadButtonText" Text="Download"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- Downloaded Badge -->
                        <Border x:Name="DownloadedBadge"
                                Background="{ThemeResource SystemAccentColor}"
                                CornerRadius="4" Padding="8,4"
                                HorizontalAlignment="Left" Margin="0,8,0,0" Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE73E;" FontSize="12" Foreground="White"/>
                                <TextBlock Text="Downloaded" Foreground="White" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>

                <!-- === NARROW: Stacked Cover above Info === -->
                <StackPanel x:Name="BookHeaderNarrow" Spacing="16" Visibility="Collapsed">
                    <!-- Cover Image (centered, smaller) -->
                    <Border CornerRadius="8"
                            Width="200" Height="300"
                            HorizontalAlignment="Center"
                            Background="{ThemeResource SystemControlBackgroundBaseLowBrush}">
                        <Grid>
                            <FontIcon Glyph="&#xE8F1;" FontSize="64" Opacity="0.3"
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            <Image x:Name="CoverImageNarrow" Stretch="UniformToFill"/>
                        </Grid>
                    </Border>

                    <!-- Book Info (stacked below cover) -->
                    <StackPanel Spacing="6">
                        <TextBlock x:Name="TitleTextNarrow" FontSize="22" FontWeight="Bold"
                                   TextWrapping="Wrap" TextAlignment="Center"/>

                        <HyperlinkButton x:Name="AuthorLinkNarrow" Click="AuthorLink_Click"
                                         Padding="0" HorizontalAlignment="Center">
                            <TextBlock x:Name="AuthorTextNarrow" FontSize="15"/>
                        </HyperlinkButton>

                        <TextBlock x:Name="NarratorTextNarrow" FontSize="13" Opacity="0.6"
                                   Visibility="Collapsed" TextAlignment="Center"/>

                        <HyperlinkButton x:Name="SeriesLinkNarrow" Click="SeriesLink_Click"
                                         Padding="0" Visibility="Collapsed" HorizontalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8F1;" FontSize="12"/>
                                <TextBlock x:Name="SeriesTextNarrow" FontSize="13"/>
                            </StackPanel>
                        </HyperlinkButton>

                        <StackPanel Orientation="Horizontal" Spacing="6" HorizontalAlignment="Center">
                            <FontIcon Glyph="&#xE916;" FontSize="12" Opacity="0.6"/>
                            <TextBlock x:Name="DurationTextNarrow" FontSize="13" Opacity="0.6"/>
                        </StackPanel>

                        <TextBlock x:Name="AddedAtTextNarrow" FontSize="12" Opacity="0.5"
                                   Visibility="Collapsed" TextAlignment="Center"/>

                        <!-- Progress Section -->
                        <StackPanel Margin="0,8,0,0" Spacing="4">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock x:Name="ProgressTextNarrow" FontSize="13"
                                           TextAlignment="Center" VerticalAlignment="Center"/>
                                <ToggleSwitch x:Name="ChapterToggleNarrow" Grid.Column="1"
                                              Header="By Chapter" OnContent="" OffContent=""
                                              Toggled="ChapterToggle_Toggled"
                                              Visibility="Collapsed"
                                              Margin="12,0,0,0" MinWidth="0"/>
                            </Grid>
                            <ProgressBar x:Name="ProgressBarNarrow" Maximum="100" Height="8"
                                         Foreground="#FF00CC66"/>
                            <TextBlock x:Name="ChapterInfoTextNarrow" FontSize="12" Opacity="0.6"
                                       Visibility="Collapsed" TextAlignment="Center"/>
                        </StackPanel>

                        <!-- Downloaded Badge -->
                        <Border x:Name="DownloadedBadgeNarrow"
                                Background="{ThemeResource SystemAccentColor}"
                                CornerRadius="4" Padding="8,4"
                                HorizontalAlignment="Center" Margin="0,4,0,0" Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE73E;" FontSize="12" Foreground="White"/>
                                <TextBlock Text="Downloaded" Foreground="White" FontSize="12"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </StackPanel>

                <!-- Metadata Details -->
                <StackPanel x:Name="MetadataPanel" Spacing="12"
                            Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                            CornerRadius="8" Padding="16">
                    <TextBlock Text="Details" FontSize="18" FontWeight="SemiBold"/>
                    <StackPanel x:Name="MetadataItemsPanel" Spacing="8"/>
                </StackPanel>

                <!-- Genres -->
                <StackPanel x:Name="GenresPanel" Spacing="8" Visibility="Collapsed">
                    <TextBlock Text="Genres" FontSize="18" FontWeight="SemiBold"/>
                    <ItemsRepeater x:Name="GenresRepeater">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="8"/>
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="12" Padding="14,6">
                                    <TextBlock Text="{x:Bind}" FontSize="12"/>
                                </Border>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>

                <!-- Tags -->
                <StackPanel x:Name="TagsPanel" Spacing="8" Visibility="Collapsed">
                    <TextBlock Text="Tags" FontSize="18" FontWeight="SemiBold"/>
                    <ItemsRepeater x:Name="TagsRepeater">
                        <ItemsRepeater.Layout>
                            <StackLayout Orientation="Horizontal" Spacing="8"/>
                        </ItemsRepeater.Layout>
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <Border Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="12" Padding="14,6">
                                    <TextBlock Text="{x:Bind}" FontSize="12"/>
                                </Border>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>

                <!-- Description -->
                <StackPanel x:Name="DescriptionPanel" Spacing="8" Visibility="Collapsed">
                    <TextBlock Text="Description" FontSize="18" FontWeight="SemiBold"/>
                    <TextBlock x:Name="DescriptionText" TextWrapping="Wrap" Opacity="0.8" LineHeight="24"/>
                </StackPanel>

                <!-- Chapters List -->
                <StackPanel x:Name="ChaptersPanel" Spacing="8" Visibility="Collapsed">
                    <TextBlock x:Name="ChaptersHeader" Text="Chapters" FontSize="18" FontWeight="SemiBold"/>
                    <ItemsRepeater x:Name="ChaptersRepeater">
                        <ItemsRepeater.Layout>
                            <StackLayout Spacing="4"/>
                        </ItemsRepeater.Layout>
                    </ItemsRepeater>
                </StackPanel>

                <!-- Audio Files List -->
                <StackPanel x:Name="TracksPanel" Spacing="8" Margin="0,0,0,80">
                    <TextBlock x:Name="TracksHeader" Text="Tracks" FontSize="18" FontWeight="SemiBold"/>
                    <ItemsRepeater x:Name="TracksRepeater">
                        <ItemsRepeater.Layout>
                            <StackLayout Spacing="4"/>
                        </ItemsRepeater.Layout>
                    </ItemsRepeater>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
