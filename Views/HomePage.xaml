<Page
    x:Class="AudioBookshelfApp.Views.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    NavigationCacheMode="Enabled">

    <Grid x:Name="HomeRootGrid" Padding="24,32,24,32" Background="{StaticResource VoidDeepBrush}">
        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="AltarLayoutStates">
                <!-- Wide: > 900px — 3-col, larger cards -->
                <VisualState x:Name="AltarWideState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="900"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HomeRootGrid.Padding" Value="32,32,32,32"/>
                        <Setter Target="LivesGridLayout.MinItemWidth" Value="200"/>
                        <Setter Target="LivesGridLayout.MinItemHeight" Value="280"/>
                        <Setter Target="LivesGridLayout.MaximumRowsOrColumns" Value="3"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Medium: 600–900px — 3-col grid -->
                <VisualState x:Name="AltarMediumState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="600"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HomeRootGrid.Padding" Value="24,32,24,32"/>
                        <Setter Target="LivesGridLayout.MinItemWidth" Value="160"/>
                        <Setter Target="LivesGridLayout.MinItemHeight" Value="240"/>
                        <Setter Target="LivesGridLayout.MaximumRowsOrColumns" Value="3"/>
                    </VisualState.Setters>
                </VisualState>

                <!-- Narrow: < 600px — 2-col grid, tighter spacing -->
                <VisualState x:Name="AltarNarrowState">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0"/>
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HomeRootGrid.Padding" Value="12,24,12,16"/>
                        <Setter Target="LivesGridLayout.MinItemWidth" Value="140"/>
                        <Setter Target="LivesGridLayout.MinItemHeight" Value="220"/>
                        <Setter Target="LivesGridLayout.MaximumRowsOrColumns" Value="2"/>
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Ritual Header — centered -->
        <StackPanel Grid.Row="0" HorizontalAlignment="Center" Spacing="8" Margin="0,0,0,24">
            <TextBlock Text="THE ALTAR"
                       Style="{StaticResource RitualDisplayStyle}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="{x:Bind ViewModel.TotalListeningTimeText, Mode=OneWay}"
                       Style="{StaticResource RitualLabelStyle}"
                       HorizontalAlignment="Center" Opacity="0.4"
                       Visibility="{x:Bind ShowGrid, Mode=OneWay}"/>
        </StackPanel>

        <!-- Loading -->
        <ProgressRing Grid.Row="1"
                      IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                      Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
                      Width="36" Height="36"
                      Foreground="{StaticResource SigilGoldDimBrush}"
                      VerticalAlignment="Center" HorizontalAlignment="Center"/>

        <!-- Empty State -->
        <StackPanel Grid.Row="1"
                    Visibility="{x:Bind ViewModel.ShowEmptyState, Mode=OneWay}"
                    VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="8">
            <TextBlock Text="THE ALTAR AWAITS"
                       Style="{StaticResource RitualTitleStyle}"
                       HorizontalAlignment="Center"/>
            <TextBlock Text="Begin listening to summon your nine lives."
                       Style="{StaticResource SubtitleStyle}"
                       Foreground="{StaticResource MistBrush}"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"/>
            <Button Content="Go to Library"
                    Style="{ThemeResource AccentButtonStyle}"
                    Margin="0,16,0,0"
                    HorizontalAlignment="Center"
                    Click="GoToLibrary_Click"/>
        </StackPanel>

        <!-- Nine Lives Grid — The Altar -->
        <ScrollViewer Grid.Row="1"
                      VerticalScrollBarVisibility="Auto"
                      Visibility="{x:Bind ShowGrid, Mode=OneWay}">
            <ItemsRepeater x:Name="LivesGrid"
                           ItemsSource="{x:Bind ViewModel.Lives, Mode=OneWay}">
                <ItemsRepeater.Layout>
                    <UniformGridLayout x:Name="LivesGridLayout"
                                       MinItemWidth="160"
                                       MinItemHeight="240"
                                       MinColumnSpacing="12"
                                       MinRowSpacing="12"
                                       MaximumRowsOrColumns="3"
                                       ItemsStretch="Fill"/>
                </ItemsRepeater.Layout>
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate>
                        <Grid CornerRadius="8"
                              Padding="0"
                              Background="{StaticResource VoidSurfaceBrush}"
                              BorderBrush="{StaticResource DustBrush}"
                              BorderThickness="1"
                              PointerEntered="Card_PointerEntered"
                              PointerExited="Card_PointerExited"
                              PointerPressed="Card_PointerPressed"
                              PointerMoved="Card_PointerMoved"
                              PointerReleased="Card_PointerReleased"
                              Tag="{Binding}">

                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Cover Art -->
                            <Grid Grid.Row="0" CornerRadius="8,8,0,0">
                                <Border Background="{StaticResource VoidElevatedBrush}"
                                        CornerRadius="8,8,0,0">
                                    <FontIcon Glyph="&#xE8F1;" FontSize="32" Opacity="0.15"
                                              Foreground="{StaticResource MistFaintBrush}"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <Image Stretch="UniformToFill"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"/>

                                <!-- Progress Ring Overlay (bottom-right) -->
                                <ProgressRing IsIndeterminate="False"
                                              Value="{Binding ProgressPercent}"
                                              Width="28" Height="28"
                                              Foreground="{StaticResource SigilGoldBrush}"
                                              Background="{StaticResource DustBrush}"
                                              HorizontalAlignment="Right" VerticalAlignment="Bottom"
                                              Margin="0,0,8,8"/>

                                <!-- LIFE Label Overlay (top-left) -->
                                <TextBlock Text="{Binding LifeLabel}"
                                           Style="{StaticResource RitualLabelStyle}"
                                           Opacity="0.35"
                                           HorizontalAlignment="Left" VerticalAlignment="Top"
                                           Margin="8,8,0,0"/>
                            </Grid>

                            <!-- Info Panel -->
                            <StackPanel Grid.Row="1" Padding="8,6,8,8" Spacing="2">
                                <TextBlock Text="{Binding DisplayTitle}"
                                           Style="{StaticResource CardTitleStyle}"
                                           MaxLines="2"
                                           TextTrimming="CharacterEllipsis"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Weight label -->
                                    <TextBlock Grid.Column="0"
                                               Text="{Binding Weight}"
                                               Style="{StaticResource RitualLabelStyle}"
                                               Foreground="{Binding Weight, Converter={StaticResource WeightToBrushConverter}}"
                                               VerticalAlignment="Center"/>

                                    <!-- Time Given -->
                                    <TextBlock Grid.Column="1"
                                               Text="{Binding TimeGiven}"
                                               Style="{StaticResource CaptionStyle}"
                                               VerticalAlignment="Center"/>
                                </Grid>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>
        </ScrollViewer>
    </Grid>
</Page>
